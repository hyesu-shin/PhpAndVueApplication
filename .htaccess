<Directory /public>
  Options Indexes FollowSymLinks MultiViews
  AddType application/x-httpd-php .php

  AllowOverride FileInfo

  Require all granted

  RewriteEngine On

  RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
  RewriteRule ^(.*) - [E=BASE:%1]

  RewriteCond %{ENV:REDIRECT_STATUS} ^$
  RewriteRule ^app\.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]

  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule .? - [L]

  RewriteRule .? %{ENV:BASE}/index.php [L]
</Directory>

<IfModule dir_module>
    DirectoryIndex index.html index.php
</IfModule>